angular.module("templates",[]).run(["$templateCache",function(e){e.put("src/templates/angular-schema-form-base64-file-upload.html",'<div class="angular-schema-form--base64-file" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false}">\n  <label class="control-label" ng-hide="form.notitle">{{form.title}}</label>\n  <div base64-file-upload="form" sf-field-model schema-validate="form">\n    <input type="file" class="base64-file--input" style="visibility:hidden;position:absolute;top:0;left:0;" ng-disabled="hasFile"/>\n    <button type="button" class="base64-file--drop-area" ng-class="{\'file-hovering\': dropAreaHover, \'has-file\': hasFile}">\n\n      <div class="base64-file--file" ng-show="hasFile">\n        <div class="base64-file--file-preview"\n             ng-style="{\'background-image\': isImage(file) ? \'url(\' + file.src + \')\': \'\'}">\n          <span ng-show="!isImage(file)">{{file.ext}}</span>\n        </div>\n        <div class="base64-file--file-name">{{file.name}}</div>\n        <div class="base64-file--file-size">{{file.humanSize}}</div>\n        <div class="base64-file--file-remove" ng-click="removeFile($event)">&#10005</div>\n      </div>\n      <span ng-hide="hasFile" class="base64-file--drop-area-description">{{form.placeholder || dropText}}</span>\n    </button>\n  </div>\n\n  <span class="help-block" sf-message="form.description"></span>\n</div>\n')}]),angular.module("angularSchemaFormBase64FileUpload",["schemaForm","templates"]).provider("base64FileUploadConfig",function(){this.setDropText=function(e){this.dropText=e},this.$get=function(){return this}}).config(["schemaFormProvider","schemaFormDecoratorsProvider","sfBuilderProvider","sfPathProvider",function(e,i,a,s){var t=function(i,a,t){if("string"===a.type&&"base64"===a.format){var r=e.stdFormObj(i,a,t);return r.key=t.path,r.type="base64file",t.lookup[s.stringify(t.path)]=r,r}};e.defaults.string.unshift(t),i.defineAddOn("bootstrapDecorator","base64file","src/templates/angular-schema-form-base64-file-upload.html",a.stdBuilders)}]),angular.module("templates",[]).run(["$templateCache",function(e){e.put("src/templates/angular-schema-form-base64-file-upload.html",'<div class="angular-schema-form--base64-file" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false}">\n  <label class="control-label" ng-hide="form.notitle">{{form.title}}</label>\n  <div base64-file-upload="form" sf-field-model schema-validate="form">\n    <input type="file" class="base64-file--input" style="visibility:hidden;position:absolute;top:0;left:0;" ng-disabled="hasFile"/>\n    <button type="button" class="base64-file--drop-area" ng-class="{\'file-hovering\': dropAreaHover, \'has-file\': hasFile}">\n\n      <div class="base64-file--file" ng-show="hasFile">\n        <div class="base64-file--file-preview"\n             ng-style="{\'background-image\': isImage(file) ? \'url(\' + file.src + \')\': \'\'}">\n          <span ng-show="!isImage(file)">{{file.ext}}</span>\n        </div>\n        <div class="base64-file--file-name">{{file.name}}</div>\n        <div class="base64-file--file-size">{{file.humanSize}}</div>\n        <div class="base64-file--file-remove" ng-click="removeFile($event)">&#10005</div>\n      </div>\n      <span ng-hide="hasFile" class="base64-file--drop-area-description">{{form.placeholder || dropText}}</span>\n    </button>\n  </div>\n\n  <span class="help-block" sf-message="form.description"></span>\n</div>\n')}]),angular.module("angularSchemaFormBase64FileUpload",["schemaForm","templates"]).provider("base64FileUploadConfig",function(){this.setDropText=function(e){this.dropText=e},this.$get=function(){return this}}).config(["schemaFormProvider","schemaFormDecoratorsProvider","sfBuilderProvider","sfPathProvider",function(e,i,a,s){var t=function(i,a,t){if("string"===a.type&&"base64"===a.format){var r=e.stdFormObj(i,a,t);return r.key=t.path,r.type="base64file",t.lookup[s.stringify(t.path)]=r,r}};e.defaults.string.unshift(t),i.defineAddOn("bootstrapDecorator","base64file","src/templates/angular-schema-form-base64-file-upload.html",a.stdBuilders)}]),angular.module("angularSchemaFormBase64FileUpload").directive("base64FileUpload",["base64FileUploadConfig","$timeout",function(e,i){return{restrict:"A",require:"ngModel",scope:!0,link:function(a,s,t,r){a.ngModel=r,a.dropAreaHover=!1,a.file=void 0,a.fileError=!1,a.dropText=e.dropText||"Klik hier om een bestand te uploaden";var n=s.find(".base64-file--drop-area")[0],l=s.find(".base64-file--input")[0],o=document.getElementsByClassName("questionnaire-avatar")[0],f=a.$eval(t.base64FileUpload).schema,d=s.find("img.base64-file--file-preview")[0];i(function(){var e=d.attributes["base64-file-fetch"].value,i=e.match(/(jpeg|jpg|png|JPEG|JPG|PNG)/);a.hasFile=!!i},0),$(d).on("load",function(){"Profielfoto"==f.title&&(document.getElementsByClassName("questionnaire-avatar")[0].src=d.currentSrc)});var c=function(e){var i=!0;return e.size>parseInt(5e4,10)?(i=!1,r.$setValidity("base64FileUploadSize",!1)):r.$setValidity("base64FileUploadSize",!0),a.$apply(),i},u=function(e){if(e&&c(e)){var s=new FileReader;if(a.file=e,a.file.ext=e.name.split(".").slice(-1)[0],a.file.src=URL.createObjectURL(e),a.hasFile=!0,"Profielfoto"==f.title){var t=a.file.src;a.addFile(t),a.addProfilePicture(t)}var n=e.size/1024,l="kB";n>1024&&(n/=1024,l="MB"),a.file.humanSize=n.toFixed(1)+" "+l,s.onloadstart=function(e){i(function(){a.loadingFile=!0},0)},s.onload=function(s){i(function(){a.loadingFile=!1},0);var t="file:"+e.name+";";a.$emit("caren.questionnaires.requestAwsKey",s.target.result,m),r.$setViewValue(t+s.target.result)},s.readAsDataURL(e),a.$apply(),a.removeDoubleImages()}};a.removeDoubleImages=function(){for(var e=document.getElementsByClassName("base64-file--file-preview"),i=e.length,a=0;a<i;a++)if(e[a]){var s=e[a].getAttribute("base64-file-fetch");null!=s&&1==(s.startsWith("data")||s.startsWith("file"))&&e[a].remove()}},a.addProfilePicture=function(e){o.src=a.file.src},a.removeProfilePicture=function(){o.src=void 0},a.isImage=function(e){return!!e&&e.type.indexOf("image")>-1},a.removeFile=function(e){e.preventDefault(),e.stopPropagation(),a.file=void 0,a.hasFile=!1,r.$setViewValue(void 0),"Profielfoto"==f.title&&a.removeProfilePicture()};var m=function(e){(e.endsWith(".jpg")||e.endsWith(".JPG")||e.endsWith(".jpeg")||e.endsWith(".JPEG")||e.endsWith(".png")||e.endsWith(".PNG"))&&(a.removeDoubleImages(),r.$setViewValue(e))};a.addFile=function(e){a.hasFile=!0,r.$setViewValue(e)},s.find("input").bind("change",function(e){u(e.target.files[0])});var p=function(e){e.stopPropagation(),l.click()},v=function(e){e.preventDefault(),e.stopPropagation(),i(function(){a.dropAreaHover=!0},0)},h=function(e){e.preventDefault(),e.stopPropagation(),i(function(){a.dropAreaHover=!1},0)},g=function(e){h(e),u(e.dataTransfer.files[0])};n.addEventListener("click",p,!1),n.addEventListener("touchstart",p,!1),n.addEventListener("dragenter",v,!1),n.addEventListener("dragleave",h,!1),n.addEventListener("dragover",v,!1),n.addEventListener("drop",g,!1),a.$on("$destroy",function(){n.removeEventListener("click",p,!1),n.removeEventListener("touchstart",p,!1),n.removeEventListener("dragenter",v,!1),n.removeEventListener("dragleave",h,!1),n.removeEventListener("dragover",v,!1),n.removeEventListener("drop",g,!1)})}}}]);